# 功能测试指南

## 测试环境准备

1. 在 Chrome 浏览器中加载扩展
2. 打开侧边栏（点击工具栏图标）
3. 确保有一些测试书签（建议至少 10 个，包含一些重复的）

## 测试一：未标记书签添加标签（Bug 修复验证）

### 前置条件
- 创建一个新书签，不添加任何标签

### 测试步骤
1. 在书签列表中找到未标记的书签
2. 点击该书签上的标签图标（🏷️）
3. 观察标签编辑对话框是否正常打开
4. 检查是否显示"暂无标签，从下方选择或输入新标签"提示
5. 在输入框中输入新标签（如：测试）
6. 按 Enter 键添加标签
7. 点击标签建议中的标签
8. 点击"保存"按钮
9. 关闭对话框，检查书签卡片上是否显示新添加的标签

### 预期结果
✅ 对话框正常打开  
✅ 显示友好的空状态提示  
✅ 可以正常添加标签  
✅ 保存后标签正确显示  

### 失败情况
❌ 对话框空白  
❌ 无法添加标签  
❌ 保存后标签未显示  

---

## 测试二：书签去重功能

### 2.1 创建测试数据

在 Chrome 书签管理器中手动添加以下重复书签：

```
1. https://www.google.com/
2. http://google.com/
3. https://www.google.com
4. HTTPS://GOOGLE.COM/

5. https://github.com/
6. https://www.github.com/
7. http://github.com

8. https://example.com/page?id=123
9. https://example.com/page?id=456
```

为一些书签添加不同的标签和颜色。

### 2.2 扫描重复

#### 测试步骤
1. 点击侧边栏顶部的去重按钮（立方体图标）
2. 观察对话框是否正常打开
3. 点击"扫描重复"按钮
4. 等待扫描完成

#### 预期结果
✅ 对话框正常打开  
✅ 显示初始提示信息  
✅ 扫描按钮变为"扫描中..."  
✅ 扫描完成后显示结果  
✅ 正确识别上述 3 组重复（google、github、example）  
✅ 统计信息正确：重复组数 3，重复书签数 9  

#### 验证点
- Google 组应该包含 4 个书签（忽略协议和 www）
- GitHub 组应该包含 3 个书签
- Example 组应该包含 2 个书签（忽略查询参数）

### 2.3 查看重复详情

#### 测试步骤
1. 在结果列表中浏览每个重复组
2. 检查每个书签的显示信息

#### 预期结果
✅ 每组显示标准化的 URL  
✅ 显示重复数量标签  
✅ 每个书签显示：
   - Favicon 图标
   - 书签标题
   - 添加时间（相对时间格式）
   - 标签（如果有）
✅ 默认选中最新添加的书签  
✅ 只能选择一个书签（单选）  

### 2.4 手动选择保留

#### 测试步骤
1. 在某个重复组中，点击不同书签的单选按钮
2. 观察选中状态变化

#### 预期结果
✅ 点击后该书签项高亮  
✅ 之前选中的书签取消高亮  
✅ 只有一个书签保持选中状态  

### 2.5 单独删除

#### 测试步骤
1. 在某个书签上点击"删除"按钮
2. 在确认对话框中点击"确定"
3. 等待删除完成

#### 预期结果
✅ 显示确认对话框  
✅ 删除成功后显示 Toast 提示  
✅ 该书签从列表中消失  
✅ 如果该组只剩 1 个书签，整组从列表中移除  
✅ 统计信息自动更新  

### 2.6 批量自动去重

#### 测试步骤
1. 确保有多个重复组
2. 为不同的重复书签添加不同的标签和颜色
3. 点击"自动去重"按钮
4. 在确认对话框中点击"确定"
5. 等待处理完成

#### 预期结果
✅ 显示确认提示："此操作不可撤销，确定继续吗？"  
✅ 按钮变为"处理中..."  
✅ 处理完成后显示结果 Toast：移除数量  
✅ 书签列表自动刷新  
✅ 保留的书签包含所有合并的标签  
✅ 保留的书签保留颜色标记  
✅ 侧边栏中不再显示已删除的书签  

### 2.7 验证元数据合并

#### 测试步骤（针对某个重复组）
1. 记录删除前每个书签的标签和颜色
   ```
   书签 A: 标签 [tag1, tag2], 颜色 红色
   书签 B: 标签 [tag2, tag3], 颜色 蓝色
   书签 C: 标签 [tag4], 无颜色
   ```
2. 选择保留书签 A
3. 执行去重
4. 检查保留的书签 A

#### 预期结果
✅ 保留书签包含所有标签：[tag1, tag2, tag3, tag4]  
✅ 标签无重复（去重处理）  
✅ 保留原有颜色（红色）  

### 2.8 空状态测试

#### 测试步骤
1. 删除所有重复书签，确保没有重复
2. 打开去重对话框
3. 点击"扫描重复"

#### 预期结果
✅ 显示"未发现重复书签"提示  
✅ "自动去重"按钮保持禁用状态  
✅ 不显示结果列表  

### 2.9 边界情况测试

#### 测试场景 A：大量重复
- 创建 50+ 个重复书签
- 执行扫描和去重
- 检查性能和稳定性

#### 测试场景 B：特殊字符 URL
```
https://example.com/页面
https://example.com/%E9%A1%B5%E9%9D%A2
```

#### 测试场景 C：非常长的 URL
```
https://example.com/very/long/path/with/many/segments/...（200+ 字符）
```

#### 预期结果
✅ 所有场景都能正常处理  
✅ 无崩溃或错误  
✅ UI 保持响应  

---

## 测试三：功能集成测试

### 测试步骤
1. 执行书签去重
2. 在保留的书签上添加新标签
3. 更改保留书签的颜色
4. 搜索保留的书签
5. 使用标签筛选
6. 导出书签
7. 重新导入

### 预期结果
✅ 所有功能正常工作  
✅ 去重后的书签与其他功能无冲突  
✅ 数据保持一致性  

---

## 测试四：错误处理

### 4.1 网络错误模拟
1. 断开网络连接（如果扩展需要）
2. 执行去重操作

### 4.2 权限错误
1. 尝试删除受保护的书签（如果有）

### 4.3 并发操作
1. 在扫描过程中快速连续点击按钮
2. 在去重过程中关闭对话框

### 预期结果
✅ 显示友好的错误提示  
✅ 不会崩溃或卡死  
✅ 可以恢复正常状态  

---

## 回归测试清单

确保新功能不影响现有功能：

- [ ] 书签添加
- [ ] 书签删除
- [ ] 书签搜索
- [ ] 标签筛选
- [ ] 颜色筛选
- [ ] 拖拽排序
- [ ] AI 标签建议
- [ ] 导入导出
- [ ] 主题切换
- [ ] 设置页面

---

## 性能测试

### 测试场景
- 1000 个书签，100 个重复
- 测量扫描时间
- 测量渲染时间
- 测量去重处理时间

### 性能指标
- 扫描：< 2 秒
- 渲染：< 1 秒
- 去重：< 5 秒

---

## 浏览器兼容性测试

在以下浏览器中测试：
- [ ] Chrome (最新版本)
- [ ] Chrome (上一个主要版本)
- [ ] Edge (最新版本)
- [ ] Brave (最新版本)

---

## 测试报告模板

```
测试日期: YYYY-MM-DD
测试人员: [姓名]
浏览器版本: Chrome XXX
扩展版本: v2.0.0

测试一：未标记书签添加标签
- 状态: ✅ 通过 / ❌ 失败
- 问题: [如有]

测试二：书签去重功能
2.1 扫描重复: ✅ / ❌
2.2 查看详情: ✅ / ❌
2.3 手动选择: ✅ / ❌
2.4 单独删除: ✅ / ❌
2.5 批量去重: ✅ / ❌
2.6 元数据合并: ✅ / ❌
2.7 空状态: ✅ / ❌
2.8 边界情况: ✅ / ❌

测试三：集成测试
- 状态: ✅ 通过 / ❌ 失败

测试四：错误处理
- 状态: ✅ 通过 / ❌ 失败

回归测试
- 所有现有功能: ✅ 正常 / ❌ 有问题

性能测试
- 扫描时间: ___ 秒
- 渲染时间: ___ 秒
- 去重时间: ___ 秒

总体评价: [通过/需修复]
```

---

## 自动化测试建议

为未来考虑添加：
1. 单元测试（Jest）
2. 集成测试（Puppeteer）
3. E2E 测试（Playwright）
4. 性能测试（Lighthouse）

建议测试覆盖率目标：> 80%
